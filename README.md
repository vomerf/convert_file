# convert_file
### В данном теcтовом задании реализовано преобразование файла из формата wav в фортам mp3 и сохранение полученных данных в базу данных postgresql и скачивание этого файла.<br>
Технологии которые используются:<br>
- Python - 3.9 можно скачать и установить https://www.python.org/
- FastAPI - 0.95.2
- SQLAlchemy - 2.0.15
- Docker<br> можно скачать и установить https://docs.docker.com/get-docker/<br>

До запуска приложения следует создать файл .env в корне проекта, где находится файл docker-compose.yaml<br>

Содержание файла .env:<br>
APP_TITLE - Заголовок который будет отображен в документации Swagger<br>
SECRET - Секрктный ключ(случайный набор символов)<br>
POSTGRES_DB - Имя базы данных<br>
POSTGRES_USER - Имя пользователя базы данных<br>
POSTGRES_PASSWORD - Пароль<br>
DB_HOST - Хост базы данных(имя контейнера с базой данных)<br>
DB_PORT - Порт базы данных<br>
Нужно заполнить эти данные пример тестовых данных будет в файле .env.example<br>

Для того чтобы запустить приложение вам нужно собрать образы базы данных и приложения для этого можно выпольнить команду `docker-compose up --build`<br>
скачается образ докера из удаленного репозитория, а также соберется образ на основе Dockerfile. Cоздадутся и запустятся контейнеры.<br>
После того как все запуститься надо выполнить команду `docker exec convert_file_web_convert_file_1 alembic upgrade head` чтобы применить миграции,<br>
если не получится возможно у вас другое имя контейнера его можно посмотреть командой docker ps, вместо имени можно написать id-контейнера.<br>

После этого можете открыть документацию Swagger в которой протестировать работу, перейдите по ссылке http://127.0.0.1:8000/docs/ <br>

Пример запросов:<br>
Делаем Post запрос на endpoint `/user/` в теле запроса передаем JSON с именем пользователя, при создании имя может повторяться, но токен будет у все разный.<br>
```
{
  "name": "Nikita"
}
```
При удачном выполнеии вернется JSON c id пользователя и токеном:
```
{
  "id": 1,
  "token": "009cd838-4af2-47af-a330-9e5d659fcb3d"
}
```
При неудачной попытке если вы например попытаетесь передать пустую строку то вернется такой ответ:<br>
```
{
  "detail": [
    {
      "loc": [
        "body",
        "name"
      ],
      "msg": "Имя должно содержать как минимум одну букву",
      "type": "value_error"
    }
  ]
}
```
Еще один пример с загрузкой и конвертацией файла.<br>
Делается Post запрос на endpoint /load_file/<br> в теле запроса в формате multipart/form_data<br>
Передается id пользователя его token и загружается запись которую мы хотим конвертировать.<br>
Если данные корректны вернется url для скачивания файла в таком виде:<br>
```
{
  "url_for_for_load_file": "http://127.0.0.1:8000/record?id=41ab8840-b971-4a02-aa4b-476c96cc3633&user=1"
}
```
Если например такой файл уже есть или передан id несуществующего пользователя то вернется ошибка:<br>
```
{
  "detail": "Такой файл уже существует"
}
```
```
{
  "detail": "Такого пользователя не существует или у него нет доступа"
}
```

